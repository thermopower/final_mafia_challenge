# Nixpacks Configuration for Railway - Backend Only
# Django REST API 배포 전용

[phases.setup]
nixPkgs = ["python311"]

[phases.install]
# 가상 환경을 생성하여 externally-managed-environment 오류 회피
cmds = [
    "python3.11 -m venv /opt/venv",
    "/opt/venv/bin/pip install --upgrade pip setuptools wheel",
    "/opt/venv/bin/pip install -r requirements/production.txt"
]

# 환경 변수 설정: 가상 환경을 기본 Python 환경으로 지정
[variables]
PATH = "/opt/venv/bin:$PATH"
VIRTUAL_ENV = "/opt/venv"
PYTHONPATH = "/app"

[start]
# 가상 환경의 Python 사용
cmd = "/opt/venv/bin/python manage.py migrate && /opt/venv/bin/python manage.py collectstatic --noinput && /opt/venv/bin/gunicorn config.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --threads 4 --timeout 120"
