# Userflow 문서 (v1.1.0)

## 목차
1. [개요](#개요)
2. [전체 사용자 여정 (User Journey)](#전체-사용자-여정-user-journey)
3. [기능별 상세 Userflow](#기능별-상세-userflow)
   - 3.1 [인증 플로우](#31-인증-플로우)
   - 3.2 [대시보드 조회 플로우](#32-대시보드-조회-플로우)
     - 3.2.1 [메인 대시보드](#321-대시보드-메인-화면-진입)
     - 3.2.2 [필터링](#322-대시보드-필터링)
     - 3.2.3 [차트 상호작용](#323-차트-상호작용)
   - 3.3 [Excel 파일 업로드 플로우 (4가지 CSV 타입)](#33-excel-파일-업로드-플로우-4가지-csv-타입)
     - 3.3.1 [업로드 페이지](#331-업로드-페이지-진입)
     - 3.3.1.1 [CSV 데이터 타입별 구조](#3311-csv-데이터-타입별-구조)
       - 타입 1: [학과 KPI 데이터](#타입-1-학과-kpi-데이터-department_kpicsv)
       - 타입 2: [논문 목록](#타입-2-논문-목록-publication_listcsv)
       - 타입 3: [연구 과제 데이터](#타입-3-연구-과제-데이터-research_project_datacsv)
       - 타입 4: [학생 명단](#타입-4-학생-명단-student_rostercsv)
     - 3.3.2 [파일 선택 및 업로드](#332-파일-선택-및-업로드)
     - 3.3.3 [업로드 이력 관리](#333-업로드-이력-관리)
   - 3.4 [데이터 조회 플로우](#34-데이터-조회-플로우)
   - 3.5 [프로필 관리 플로우](#35-프로필-관리-플로우)
4. [화면 전환 다이어그램](#화면-전환-다이어그램)
5. [예외 상황 처리](#예외-상황-처리)
6. [엣지케이스 시나리오](#엣지케이스-시나리오)
7. [부록: 주요 API 엔드포인트](#부록-주요-api-엔드포인트)

---

## 개요

### 프로젝트 정보
- **프로젝트명**: 대학교 사내 데이터 시각화 대시보드
- **문서 버전**: v1.1.0
- **작성일**: 2025년 11월 2일
- **기술 스택**: Django REST Framework + React + Supabase
- **주요 사용자**: 대학교 내부 직원 (관리자 및 일반 사용자)
- **핵심 목적**: 이카운트 시스템에서 추출한 데이터(CSV/엑셀)를 직관적으로 시각화하여 의사결정 지원

### 주요 데이터 유형 (4가지 CSV 파일)
1. **학과 KPI 데이터** (department_kpi.csv)
   - 평가년도별 단과대학 및 학과 성과 지표
   - 취업률, 교원 수, 기술이전 수입, 학술대회 개최 횟수 등

2. **논문 목록** (publication_list.csv)
   - 학술지 게재 논문 정보
   - 주저자, 참여저자, Impact Factor, 과제 연계 여부 등

3. **연구 과제 데이터** (research_project_data.csv)
   - 연구 과제별 예산 집행 현황
   - 연구책임자, 지원기관, 집행 항목, 집행 상태 등

4. **학생 명단** (student_roster.csv)
   - 학생 기본 정보 및 학적 상태
   - 학년, 과정 구분, 학적 상태, 지도교수, 입학년도 등

### 사용자 역할 및 권한
- **관리자 (Admin)**
  - Excel/CSV 파일 업로드 및 관리
  - 모든 대시보드 조회 및 데이터 관리
  - 사용자 관리, 예산 집행 대시보드 접근 가능

- **일반 사용자 (User)**
  - 대시보드 조회 및 필터링
  - 데이터 조회 및 CSV 내보내기
  - 프로필 관리

---

## 전체 사용자 여정 (User Journey)

### 초기 접속부터 데이터 시각화까지의 전체 흐름

```
[웹사이트 접속]
    ↓
[로그인 페이지 진입]
    ↓
[인증 정보 입력 및 로그인]
    ↓
[대시보드 페이지 자동 이동]
    ↓
[시각화된 데이터 확인]
    ↓
┌─────────────────────────────────────┐
│ 사용자 역할에 따른 행동 분기        │
├─────────────────────────────────────┤
│ [관리자]              [일반 사용자] │
│   ↓                        ↓        │
│ Excel 업로드         데이터 조회    │
│   ↓                        ↓        │
│ 데이터 확인          차트 분석      │
│   ↓                        ↓        │
│ 프로필 관리          프로필 확인    │
└─────────────────────────────────────┘
    ↓
[로그아웃]
```

### 주요 화면 구조

```
┌─────────────────────────────────────────────┐
│         Navigation Bar (로그인 후)          │
│  [Logo] [Dashboard] [Upload] [Data] [Profile] │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│           Main Content Area                 │
│  (현재 선택된 페이지 내용 표시)            │
└─────────────────────────────────────────────┘
```

---

## 기능별 상세 Userflow

## 3.1 인증 플로우

### 3.1.1 로그인 플로우

#### 입력
- 사용자 이메일 (Email)
- 비밀번호 (Password)
- [선택] "로그인 상태 유지" 체크박스

#### 처리
1. **화면 진입**
   - URL: `/login`
   - 이미 로그인된 사용자인 경우 대시보드로 자동 리다이렉트
   - 로그아웃 상태: 로그인 폼 표시

2. **입력 검증 (Frontend)**
   - 이메일 형식 검증 (정규식: `^[^\s@]+@[^\s@]+\.[^\s@]+$`)
   - 비밀번호 필드 공백 체크
   - 검증 실패 시 인라인 오류 메시지 표시

3. **인증 요청 (Frontend → Supabase Auth)**
   - `authService.login(email, password)` 호출
   - Supabase Auth API로 인증 요청 전송

4. **인증 처리 (Supabase Auth)**
   - 사용자 자격증명 검증
   - JWT 토큰 생성 (Access Token + Refresh Token)
   - 사용자 정보 반환

5. **토큰 저장 (Frontend)**
   - Access Token: `localStorage` 또는 `sessionStorage`에 저장
   - Refresh Token: `httpOnly cookie` 또는 `localStorage`에 저장
   - 사용자 정보를 `AuthContext`에 저장

6. **권한 확인 (Backend)**
   - JWT 토큰을 Authorization Header에 포함하여 Backend API 호출
   - `AuthMiddleware`가 JWT 검증
   - 사용자 역할(Role) 추출 및 요청 객체에 첨부

7. **프로필 정보 로드 (Optional)**
   - `accountApi.getProfile()` 호출
   - 사용자 프로필 정보 가져오기
   - 프로필 사진, 이름, 부서 등 표시

#### 출력
- **성공**
  - 대시보드 페이지로 리다이렉트 (`/dashboard`)
  - 환영 메시지 표시: "환영합니다, {사용자이름}님"
  - Navigation Bar에 사용자 정보 표시

- **실패**
  - 오류 메시지 표시
    - 잘못된 자격증명: "이메일 또는 비밀번호가 올바르지 않습니다."
    - 네트워크 오류: "서버에 연결할 수 없습니다. 잠시 후 다시 시도해주세요."
    - 계정 비활성화: "이 계정은 비활성화되었습니다. 관리자에게 문의하세요."
  - 입력 필드는 유지 (비밀번호 제외)

#### 예외 처리
- **이메일 미인증 사용자**
  - 오류 메시지: "이메일 인증이 필요합니다. 인증 메일을 확인해주세요."
  - "인증 메일 재발송" 버튼 표시

- **다중 로그인 시도 실패**
  - 5회 실패 시 계정 일시 잠금 (15분)
  - 오류 메시지: "로그인 시도 횟수를 초과했습니다. 15분 후 다시 시도해주세요."

- **세션 만료**
  - Refresh Token으로 자동 갱신 시도
  - 갱신 실패 시 로그인 페이지로 리다이렉트
  - 메시지: "세션이 만료되었습니다. 다시 로그인해주세요."

---

### 3.1.2 로그아웃 플로우

#### 입력
- Navigation Bar에서 "로그아웃" 버튼 클릭

#### 처리
1. **로그아웃 확인 다이얼로그 표시**
   - 메시지: "로그아웃하시겠습니까?"
   - [취소] [로그아웃] 버튼

2. **로그아웃 실행**
   - Supabase Auth 로그아웃 API 호출
   - 로컬 스토리지에서 토큰 삭제
   - AuthContext 초기화

3. **세션 무효화 (Backend)**
   - 서버측 세션 무효화 (Optional)
   - Refresh Token 블랙리스트 등록 (Optional)

#### 출력
- 로그인 페이지로 리다이렉트
- 메시지: "로그아웃되었습니다."
- 모든 인증 정보 제거

#### 예외 처리
- **네트워크 오류**
  - 로컬 토큰만 삭제하고 로그아웃 진행
  - 메시지: "로그아웃되었습니다. (서버 동기화 실패)"

---

### 3.1.3 권한 검증 플로우 (모든 API 요청 시)

#### 입력
- HTTP 요청 (Authorization Header에 JWT 포함)

#### 처리
1. **Axios Interceptor (Frontend)**
   - 모든 API 요청에 `Authorization: Bearer {token}` 헤더 자동 추가

2. **AuthMiddleware 검증 (Backend)**
   - JWT 토큰 추출
   - Supabase JWT Secret으로 서명 검증
   - 토큰 만료 여부 확인
   - 페이로드에서 사용자 ID 및 역할 추출

3. **권한 확인**
   - 요청 경로와 사용자 역할 매칭
   - 관리자 전용 경로: `/api/upload/`, `/api/data/delete/`
   - 일반 사용자 접근 허용: `/api/dashboard/`, `/api/data/view/`

#### 출력
- **성공**
  - 요청 처리 계속
  - `request.user`에 사용자 정보 첨부

- **실패**
  - **401 Unauthorized**: 토큰 없음 또는 유효하지 않음
    - Frontend: 자동으로 로그인 페이지로 리다이렉트
    - 메시지: "인증이 필요합니다. 다시 로그인해주세요."

  - **403 Forbidden**: 권한 없음
    - 메시지: "접근 권한이 없습니다."
    - 이전 페이지로 돌아가기

---

## 3.2 대시보드 조회 플로우

### 3.2.1 대시보드 메인 화면 진입

#### 입력
- 로그인 성공 후 자동 리다이렉트
- 또는 Navigation Bar에서 "Dashboard" 클릭

#### 처리
1. **페이지 로딩**
   - URL: `/dashboard`
   - 로딩 스피너 표시

2. **대시보드 데이터 요청 (Frontend)**
   - `dashboardApi.getDashboard(filters)` 호출
   - 필터 파라미터:
     - `year`: 조회 연도 (기본값: 현재 연도)
     - `quarter`: 분기 (선택적)
     - `department`: 부서 (선택적)

3. **데이터 조회 (Backend)**
   - `DashboardView` 요청 수신
   - `DashboardService.get_dashboard_summary(filters)` 호출
   - 병렬로 여러 Repository 호출:
     - `PerformanceRepository.get_summary(filters)`
     - `PaperRepository.get_count_by_period(filters)`
     - `StudentRepository.get_count_by_department(filters)`
     - `BudgetRepository.get_total_by_category(filters)`

4. **지표 계산 (Service Layer)**
   - `MetricCalculator.calculate_trends()`: 전년 대비 증감률 계산
   - `MetricCalculator.calculate_growth_rate()`: 성장률 계산
   - `MetricCalculator.calculate_average()`: 평균값 계산

5. **차트 데이터 생성 (Service Layer)**
   - `ChartDataBuilder.build_performance_chart()`: 실적 차트 데이터
   - `ChartDataBuilder.build_paper_trend_chart()`: 논문 추세 차트
   - `ChartDataBuilder.build_budget_pie_chart()`: 예산 비율 파이 차트
   - `ChartDataBuilder.build_student_bar_chart()`: 학생 수 막대 차트

6. **응답 생성 (Backend)**
   - Domain Model → JSON 직렬화 (DRF Serializer)
   - HTTP 200 응답 반환

7. **데이터 변환 (Frontend)**
   - `ChartTransformer.transformForRecharts()`: Recharts 형식으로 변환
   - 날짜 포맷팅, 숫자 포맷팅 적용

8. **UI 렌더링 (Frontend)**
   - 로딩 스피너 제거
   - 대시보드 컴포넌트 렌더링

#### 출력
- **대시보드 레이아웃 구성**

```
┌─────────────────────────────────────────────────────────┐
│  대시보드                                    [연도 선택] │
├─────────────────────────────────────────────────────────┤
│  주요 지표 카드 (4개)                                   │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │
│  │  실적    │ │  논문    │ │  학생    │ │  예산    │  │
│  │ 1.2억원  │ │  45편    │ │  320명   │ │ 8천만원  │  │
│  │ ↑ 15%    │ │ ↑ 8%     │ │ ↓ 3%     │ │ → 0%     │  │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │
├─────────────────────────────────────────────────────────┤
│  차트 영역                                              │
│  ┌────────────────────────┐ ┌────────────────────────┐ │
│  │  실적 추세 (라인 차트) │ │  논문 분포 (막대 차트) │ │
│  │                        │ │                        │ │
│  │        /\  /\          │ │    ║    ║    ║    ║   │ │
│  │   /\  /  \/  \         │ │  ╔═╝  ╔═╝  ╔═╝  ╔═╝   │ │
│  │  /  \/        \        │ │  ║    ║    ║    ║     │ │
│  └────────────────────────┘ └────────────────────────┘ │
│  ┌────────────────────────┐ ┌────────────────────────┐ │
│  │  예산 비율 (파이 차트) │ │  학생 수 (막대 차트)   │ │
│  │                        │ │                        │ │
│  │       ◐◑◑◑             │ │    ║    ║    ║    ║   │ │
│  │       ◑◑◑◑             │ │  ╔═╝  ╔═╝  ╔═╝  ╔═╝   │ │
│  │                        │ │  ║    ║    ║    ║     │ │
│  └────────────────────────┘ └────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

- **주요 지표 카드 항목**
  - 지표명
  - 현재 값
  - 전년 대비 증감률 (색상: 증가=녹색, 감소=빨간색, 동일=회색)
  - 아이콘 (↑ 증가, ↓ 감소, → 동일)

- **차트별 세부 정보**
  1. **실적 추세 라인 차트**
     - X축: 월 (1월 ~ 12월)
     - Y축: 실적 금액 (원)
     - 툴팁: 마우스 오버 시 상세 금액 표시

  2. **논문 분포 막대 차트**
     - X축: 분야 (국내학술지, 국제학술지, 학술대회 등)
     - Y축: 논문 수 (편)
     - 색상: 분야별 구분

  3. **예산 비율 파이 차트**
     - 카테고리: 인건비, 연구비, 운영비, 기타
     - 비율 및 금액 표시
     - 범례 표시

  4. **학생 수 막대 차트**
     - X축: 학과 또는 학년
     - Y축: 학생 수 (명)
     - 색상: 학과별 구분

#### 예외 처리
- **데이터 없음**
  - 빈 상태 UI 표시
  - 메시지: "조회 가능한 데이터가 없습니다."
  - 관리자인 경우: "Excel 파일을 업로드해주세요." + [업로드 페이지로 이동] 버튼

- **부분 데이터 로드 실패**
  - 로드 성공한 차트만 표시
  - 실패한 차트 영역에 오류 메시지: "데이터를 불러올 수 없습니다. [재시도]"

- **전체 데이터 로드 실패**
  - 오류 화면 표시
  - 메시지: "대시보드 데이터를 불러오는 중 오류가 발생했습니다."
  - [다시 시도] 버튼

---

### 3.2.2 대시보드 필터링

#### 입력
- 연도 선택 드롭다운
- 분기 선택 (Q1, Q2, Q3, Q4, 전체)
- 부서 선택 (전체, 특정 부서)
- [적용] 버튼

#### 처리
1. **필터 변경 감지**
   - 드롭다운 선택 변경 시 임시 저장
   - [적용] 버튼 클릭 시 API 재요청

2. **쿼리 파라미터 업데이트**
   - URL 쿼리 스트링 업데이트: `/dashboard?year=2024&quarter=Q1&department=CS`
   - 브라우저 히스토리에 추가 (뒤로가기 가능)

3. **데이터 재조회**
   - 로딩 스피너 표시 (기존 차트는 반투명 처리)
   - 새로운 필터로 `dashboardApi.getDashboard(filters)` 호출
   - 3.2.1과 동일한 처리 과정

#### 출력
- 필터링된 데이터로 차트 업데이트
- 애니메이션 효과 적용 (차트 전환)

#### 예외 처리
- **필터 조합으로 데이터 없음**
  - 빈 상태 메시지: "선택한 조건에 해당하는 데이터가 없습니다."
  - 필터 초기화 버튼 표시

---

### 3.2.3 차트 상호작용

#### 입력
- 차트 영역 마우스 호버
- 차트 항목 클릭 (드릴다운)
- 범례 항목 클릭 (토글)

#### 처리
1. **툴팁 표시 (호버)**
   - 마우스 위치의 데이터 포인트 하이라이트
   - 상세 정보 팝업 표시

2. **드릴다운 (클릭)**
   - 예: 파이 차트의 "인건비" 클릭 → 인건비 세부 내역 모달 표시
   - 모달 내용:
     - 테이블 형태의 세부 데이터
     - [닫기] 버튼

3. **범례 토글 (클릭)**
   - 클릭한 범례 항목의 데이터 시리즈 숨김/표시
   - 차트 자동 리스케일

#### 출력
- 툴팁: 데이터 값, 비율, 날짜 등 상세 정보
- 드릴다운 모달: 세부 데이터 테이블
- 범례 토글: 시각적 피드백 (회색 처리)

---

## 3.3 Excel 파일 업로드 플로우 (4가지 CSV 타입)

### 3.3.1 업로드 페이지 진입

#### 입력
- Navigation Bar에서 "Upload" 클릭
- 또는 URL 직접 접근: `/upload`

#### 처리
1. **권한 확인**
   - 관리자 권한 검증 (Frontend + Backend)
   - 일반 사용자: 403 Forbidden

2. **페이지 렌더링**
   - 업로드 폼 표시
   - 과거 업로드 이력 테이블 표시 (최근 10건)

#### 출력
- **업로드 페이지 레이아웃**

```
┌─────────────────────────────────────────────────────────┐
│  Excel 파일 업로드                                      │
├─────────────────────────────────────────────────────────┤
│  파일 업로드                                            │
│  ┌───────────────────────────────────────────────────┐  │
│  │  여기에 파일을 드래그하거나 클릭하여 선택하세요   │  │
│  │                   📄                               │  │
│  │         지원 형식: .xlsx, .csv                     │  │
│  │         최대 크기: 10MB                            │  │
│  └───────────────────────────────────────────────────┘  │
│  데이터 유형: [선택] ▼                                  │
│    1. 학과 KPI 데이터 (department_kpi)                 │
│    2. 논문 목록 (publication_list)                     │
│    3. 연구 과제 데이터 (research_project_data)         │
│    4. 학생 명단 (student_roster)                       │
│  [업로드] 버튼                                          │
├─────────────────────────────────────────────────────────┤
│  업로드 이력                                            │
│  ┌───────────────────────────────────────────────────┐  │
│  │ 날짜      파일명        유형    상태    작업      │  │
│  │ 2024-11-01  dept_kpi.xlsx  학과KPI  성공  [삭제] │  │
│  │ 2024-10-28  papers.xlsx   논문    성공    [삭제]  │  │
│  │ 2024-10-25  projects.xlsx 연구과제 실패 [재시도] │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

#### 예외 처리
- **일반 사용자 접근 시도**
  - 403 페이지 표시
  - 메시지: "관리자만 접근할 수 있습니다."
  - [대시보드로 돌아가기] 버튼

---

### 3.3.1.1 CSV 데이터 타입별 구조

#### 타입 1: 학과 KPI 데이터 (department_kpi.csv)

**필수 컬럼 및 데이터 타입**:
| 컬럼명 | 데이터 타입 | 범위/형식 | 예시 |
|--------|-----------|----------|------|
| 평가년도 | 정수 | 2020~2030 | 2024 |
| 단과대학 | 문자열 | - | 공과대학 |
| 학과 | 문자열 | - | 컴퓨터공학과 |
| 졸업생 취업률 (%) | 실수 | 0~100 | 87.5 |
| 전임교원 수 (명) | 정수 | 0 이상 | 35 |
| 초빙교원 수 (명) | 정수 | 0 이상 | 12 |
| 연간 기술이전 수입액 (억원) | 실수 | 0 이상 | 2.5 |
| 국제학술대회 개최 횟수 | 정수 | 0 이상 | 3 |

**CSV 샘플 데이터**:
```csv
평가년도,단과대학,학과,졸업생 취업률 (%),전임교원 수 (명),초빙교원 수 (명),연간 기술이전 수입액 (억원),국제학술대회 개최 횟수
2024,공과대학,컴퓨터공학과,87.5,35,12,2.5,3
2024,공과대학,전자공학과,85.0,28,10,1.8,2
2024,인문대학,국어국문학과,72.3,18,5,0.2,1
2024,사범대학,교육학과,79.5,22,8,0.5,1
2023,공과대학,컴퓨터공학과,82.1,35,10,2.0,2
2023,공과대학,전자공학과,78.5,28,9,1.5,2
```

**검증 규칙**:
- (평가년도, 학과) 조합이 고유해야 함
- 취업률은 0~100 범위, 소수점 1자리
- 교원 수, 개최 횟수는 0 이상의 정수
- 수입액은 소수점 1자리, 음수 불가

---

#### 타입 2: 논문 목록 (publication_list.csv)

**필수 컬럼 및 데이터 타입**:
| 컬럼명 | 데이터 타입 | 범위/형식 | 예시 |
|--------|-----------|----------|------|
| 논문ID | 문자열 | PUB-YY-NNN | PUB-24-001 |
| 게재일 | 날짜 | YYYY-MM-DD | 2024-03-15 |
| 단과대학 | 문자열 | - | 공과대학 |
| 학과 | 문자열 | - | 컴퓨터공학과 |
| 논문제목 | 문자열 | 1~500자 | Deep Learning in Network Security |
| 주저자 | 문자열 | - | 김민준 |
| 참여저자 | 문자열 | ;로 구분 | 박지훈;최민서 |
| 학술지명 | 문자열 | - | IEEE Transactions on Computers |
| 저널등급 | 문자열 | SCIE, KCI | SCIE |
| Impact Factor | 실수 | 0 이상 또는 빈값 | 3.45 |
| 과제연계여부 | 문자열 | Y, N | Y |

**CSV 샘플 데이터**:
```csv
논문ID,게재일,단과대학,학과,논문제목,주저자,참여저자,학술지명,저널등급,Impact Factor,과제연계여부
PUB-24-001,2024-03-15,공과대학,컴퓨터공학과,Deep Learning in Network Security,김민준,박지훈;최민서,IEEE Transactions on Computers,SCIE,3.45,Y
PUB-24-002,2024-04-20,공과대학,전자공학과,Advanced Signal Processing,이서연,박서정,Journal of Electronics,SCIE,2.12,N
PUB-24-003,2024-05-10,인문대학,국어국문학과,고전시가의 현대적 해석,최은경,이선영,국문학보,KCI,,Y
PUB-23-001,2023-02-18,공과대학,컴퓨터공학과,Machine Learning Applications,김민준,,ACM Computing Surveys,SCIE,5.23,Y
```

**검증 규칙**:
- 논문ID가 고유해야 함
- 게재일은 YYYY-MM-DD 형식
- Impact Factor는 SCIE 논문은 값 필수, KCI는 빈값 허용
- 과제연계여부는 Y 또는 N만 허용

---

#### 타입 3: 연구 과제 데이터 (research_project_data.csv)

**필수 컬럼 및 데이터 타입**:
| 컬럼명 | 데이터 타입 | 범위/형식 | 예시 |
|--------|-----------|----------|------|
| 집행ID | 문자열 | T2324NNN | T2301001 |
| 과제번호 | 문자열 | - | NRF-2023-015 |
| 과제명 | 문자열 | - | 차세대 AI 반도체 설계 |
| 연구책임자 | 문자열 | - | 김민준 |
| 소속학과 | 문자열 | - | 컴퓨터공학과 |
| 지원기관 | 문자열 | - | 한국연구재단 |
| 총연구비 | 정수 | 0 이상 (단위:원) | 500000000 |
| 집행일자 | 날짜 | YYYY-MM-DD | 2024-03-15 |
| 집행항목 | 문자열 | - | 연구장비 도입 |
| 집행금액 | 정수 | 0 이상 (단위:원) | 150000000 |
| 상태 | 문자열 | 집행완료, 처리중 | 집행완료 |
| 비고 | 문자열 | 선택사항 | 특수장비 구입 |

**CSV 샘플 데이터**:
```csv
집행ID,과제번호,과제명,연구책임자,소속학과,지원기관,총연구비,집행일자,집행항목,집행금액,상태,비고
T2301001,NRF-2023-015,차세대 AI 반도체 설계,김민준,컴퓨터공학과,한국연구재단,500000000,2024-03-15,연구장비 도입,150000000,집행완료,특수장비 구입
T2301002,NRF-2023-015,차세대 AI 반도체 설계,김민준,컴퓨터공학과,한국연구재단,500000000,2024-04-20,인건비,180000000,집행완료,연구원 급여
T2302001,IITP-2023-A-101,클라우드 기반 빅데이터,이서연,전자공학과,정보통신기획평가원,300000000,2024-02-10,시약 및 재료비,80000000,집행완료,실험 재료 구입
T2303001,SME-2023-C-50,중소기업 지원 과제,박서정,산업공학과,중소벤처기업부,200000000,2024-05-15,외부전문가 활용비,50000000,처리중,컨설팅 비용
```

**검증 규칙**:
- 집행ID가 고유해야 함
- 총연구비 >= 집행금액의 합
- 집행일자는 YYYY-MM-DD 형식
- 상태는 "집행완료" 또는 "처리중"만 허용

---

#### 타입 4: 학생 명단 (student_roster.csv)

**필수 컬럼 및 데이터 타입**:
| 컬럼명 | 데이터 타입 | 범위/형식 | 예시 |
|--------|-----------|----------|------|
| 학번 | 문자열 | YYYYMMNNN | 20201101 |
| 이름 | 문자열 | 2~50자 | 김유진 |
| 단과대학 | 문자열 | - | 공과대학 |
| 학과 | 문자열 | - | 컴퓨터공학과 |
| 학년 | 정수 | 0~4 | 3 |
| 과정구분 | 문자열 | 학사, 석사, 박사 | 학사 |
| 학적상태 | 문자열 | 재학, 휴학, 졸업 | 재학 |
| 성별 | 문자열 | 남, 여 | 남 |
| 입학년도 | 정수 | 2015~2025 | 2020 |
| 지도교수 | 문자열 | - 또는 빈값 | 이서연 |
| 이메일 | 문자열 | 이메일 형식 | yjkim@university.ac.kr |

**CSV 샘플 데이터**:
```csv
학번,이름,단과대학,학과,학년,과정구분,학적상태,성별,입학년도,지도교수,이메일
20201101,김유진,공과대학,컴퓨터공학과,3,학사,재학,남,2020,,yjkim@university.ac.kr
20201205,박지훈,공과대학,컴퓨터공학과,3,학사,재학,남,2020,,jbpark@university.ac.kr
20221001,최민서,공과대학,컴퓨터공학과,1,학사,재학,여,2022,,mscho@university.ac.kr
20231501,이한솔,공과대학,전자공학과,2,학사,재학,남,2023,,hslee@university.ac.kr
20151201,이은지,공과대학,컴퓨터공학과,0,석사,재학,여,2023,이서연,ejlee@university.ac.kr
20211301,박서정,인문대학,국어국문학과,0,석사,재학,여,2023,최은경,sjpark@university.ac.kr
20201801,김준호,공과대학,전자공학과,4,학사,졸업,남,2020,,junhokim@university.ac.kr
20181001,오수현,공과대학,컴퓨터공학과,0,박사,재학,남,2021,김민준,shoh@university.ac.kr
```

**검증 규칙**:
- 학번이 고유해야 함
- 학년: 학사 1~4, 석사/박사는 0
- 과정구분은 "학사", "석사", "박사" 중 하나
- 학적상태는 "재학", "휴학", "졸업" 중 하나
- 성별은 "남" 또는 "여"
- 지도교수는 선택사항 (학부생은 빈값 가능)
- 이메일 형식 검증

---

### 3.3.2 파일 선택 및 업로드

#### 입력
- 파일 드래그 앤 드롭 또는 파일 선택 다이얼로그
- 데이터 유형 선택 (드롭다운)
- [업로드] 버튼 클릭

#### 처리
1. **파일 선택 (Frontend)**
   - 파일 선택 시 파일명 표시
   - 파일 아이콘 변경 (📄 → 📊)

2. **클라이언트 측 검증 (Frontend)**
   - 파일 확장자 확인 (`.xlsx`, `.xls`만 허용)
   - 파일 크기 확인 (최대 10MB)
   - 데이터 유형 선택 여부 확인
   - 검증 실패 시 오류 메시지 표시

3. **업로드 시작**
   - [업로드] 버튼 비활성화
   - 프로그레스 바 표시 (0%)
   - `uploadApi.uploadExcel(file, dataType)` 호출

4. **파일 전송 (Frontend → Backend)**
   - FormData 생성:
     - `file`: Excel 파일 (Binary)
     - `data_type`: 데이터 유형 (예: "performance")
   - Axios로 POST 요청: `/api/upload/excel/`
   - 업로드 진행률 추적 (`onUploadProgress`)

5. **파일 수신 및 검증 (Backend)**
   - `UploadView` 요청 수신
   - `FileUploadSerializer`로 검증:
     - 파일 존재 여부
     - MIME 타입 확인 (`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`)
     - 파일 크기 제한
   - 임시 디렉토리에 파일 저장

6. **파일 처리 (Service Layer)**
   - `FileProcessorService.process_file(file, data_type)` 호출
   - `ExcelParser.parse(file_path)` 호출:
     - openpyxl로 Excel 파일 열기
     - 시트 선택 (첫 번째 시트 또는 지정된 시트)
     - 헤더 행 인식 (첫 번째 행)
     - 데이터 행 파싱 (두 번째 행부터)
   - 파싱 결과: `List[Dict]` (각 행이 딕셔너리)

7. **데이터 검증 (Service Layer)**
   - `DataValidator.validate(data, data_type)` 호출
   - 데이터 유형별 검증 규칙 적용:
     - **실적 데이터**: 필수 컬럼 (날짜, 금액, 카테고리)
     - **논문 데이터**: 필수 컬럼 (제목, 저자, 게재일, 분야)
     - **학생 데이터**: 필수 컬럼 (학번, 이름, 학과, 학년)
     - **예산 데이터**: 필수 컬럼 (항목, 금액, 카테고리)
   - 데이터 타입 검증 (날짜, 숫자 등)
   - 범위 검증 (음수 금액 불가 등)
   - 중복 검증 (이미 존재하는 데이터)

8. **데이터 저장 (Repository Layer)**
   - 검증 성공 시 데이터베이스에 저장
   - 배치 삽입 (Bulk Create) 사용 (성능 최적화)
   - 트랜잭션 처리 (전체 성공 또는 전체 롤백)
   - 예:
     - `PerformanceRepository.bulk_create(performance_list)`
     - `PaperRepository.bulk_create(paper_list)`

9. **파일 메타데이터 저장**
   - `FileRepository.create()` 호출
   - 저장 정보:
     - 파일명
     - 데이터 유형
     - 업로드 일시
     - 업로드 사용자
     - 처리된 행 수
     - 상태 (성공/실패)

10. **응답 반환 (Backend → Frontend)**
    - HTTP 201 Created
    - 응답 본문:
      ```json
      {
        "id": 123,
        "filename": "실적.xlsx",
        "data_type": "performance",
        "rows_processed": 245,
        "status": "success",
        "uploaded_at": "2024-11-01T10:30:00Z"
      }
      ```

11. **UI 업데이트 (Frontend)**
    - 프로그레스 바 100%
    - 성공 메시지 표시
    - 업로드 이력 테이블 갱신
    - 폼 초기화 (다음 업로드 대비)

#### 출력
- **성공**
  - 성공 알림: "파일이 성공적으로 업로드되었습니다. (245행 처리됨)"
  - 업로드 이력 테이블 최상단에 새 항목 추가
  - [대시보드 보기] 버튼 표시

- **부분 성공** (일부 행만 처리됨)
  - 경고 알림: "245행 중 230행이 처리되었습니다. 15행은 오류로 인해 제외되었습니다."
  - 오류 행 다운로드 버튼 제공
  - 오류 상세 내역 모달 표시 옵션

- **실패**
  - 오류 알림: 구체적인 오류 메시지
  - 예:
    - "지원하지 않는 파일 형식입니다."
    - "필수 컬럼이 누락되었습니다: [날짜, 금액]"
    - "3행: 날짜 형식이 올바르지 않습니다 (2024/11/01 → 2024-11-01 형식 필요)"
  - [다시 시도] 버튼

#### 예외 처리

##### 파일 형식 오류
- **입력**: `.csv` 파일 업로드 시도
- **처리**: 클라이언트 측에서 거부
- **출력**: "Excel 파일(.xlsx, .xls)만 업로드 가능합니다."

##### 파일 크기 초과
- **입력**: 15MB 파일 업로드 시도
- **처리**: 클라이언트 측에서 거부
- **출력**: "파일 크기가 10MB를 초과합니다. (현재: 15MB)"

##### 필수 컬럼 누락
- **입력**: "금액" 컬럼이 없는 실적 Excel
- **처리**: `DataValidator`에서 검증 실패
- **출력**:
  ```
  필수 컬럼이 누락되었습니다:
  - 금액 (필수)

  현재 파일의 컬럼: 날짜, 카테고리, 비고
  ```

##### 데이터 타입 오류
- **입력**: 금액 컬럼에 문자열 "백만원" 입력
- **처리**: `DataValidator`에서 검증 실패
- **출력**:
  ```
  데이터 형식 오류:
  - 5행 금액: "백만원"은 숫자가 아닙니다.
  - 12행 날짜: "작년"은 날짜 형식이 아닙니다 (YYYY-MM-DD 필요).

  오류 행을 제외하고 업로드하시겠습니까? [제외하고 업로드] [취소]
  ```

##### 중복 데이터
- **입력**: 이미 존재하는 데이터 재업로드
- **처리**: `DataValidator` 또는 Repository에서 중복 감지
- **출력**:
  ```
  중복 데이터 발견:
  - 15행: 2024-11-01 실적 데이터는 이미 존재합니다.

  중복 데이터를 덮어쓰시겠습니까?
  [덮어쓰기] [건너뛰기] [취소]
  ```

##### 네트워크 오류 (업로드 중단)
- **입력**: 업로드 중 네트워크 연결 끊김
- **처리**: Axios 오류 감지, 재시도 로직
- **출력**:
  ```
  업로드 중 오류가 발생했습니다.
  [재시도] [취소]

  (자동 재시도: 3회까지)
  ```

##### 서버 처리 시간 초과
- **입력**: 10만 행 이상의 대용량 Excel 파일
- **처리**: 백엔드에서 타임아웃 발생 또는 비동기 처리
- **출력**:
  ```
  파일이 매우 큽니다. 백그라운드에서 처리됩니다.
  처리 완료 시 이메일로 알림을 받으시겠습니까? [예] [아니오]

  [업로드 이력]에서 진행 상황을 확인할 수 있습니다.
  ```

##### 파일 손상
- **입력**: 손상된 Excel 파일
- **처리**: openpyxl 파싱 오류 발생
- **출력**: "파일이 손상되었거나 올바른 Excel 형식이 아닙니다."

---

### 3.3.3 업로드 이력 관리

#### 입력
- 업로드 이력 테이블에서 [삭제] 또는 [재시도] 버튼 클릭

#### 처리 (삭제)
1. **확인 다이얼로그**
   - 메시지: "이 업로드 기록과 관련 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."
   - [취소] [삭제] 버튼

2. **삭제 요청**
   - `uploadApi.deleteUpload(uploadId)` 호출
   - Backend에서 파일 메타데이터 및 관련 데이터 삭제 (소프트 삭제 또는 하드 삭제)

3. **UI 업데이트**
   - 테이블에서 해당 행 제거 (페이드아웃 애니메이션)
   - 성공 메시지: "업로드 기록이 삭제되었습니다."

#### 처리 (재시도)
1. **실패한 파일 재처리**
   - 저장된 파일 경로에서 파일 다시 로드
   - 3.3.2의 파일 처리 과정 재실행

2. **UI 업데이트**
   - 상태 "처리 중"으로 변경
   - 완료 후 상태 업데이트 (성공/실패)

#### 출력
- 이력 테이블 업데이트
- 성공/실패 메시지

---

## 3.4 데이터 조회 플로우

### 3.4.1 데이터 조회 페이지 진입

#### 입력
- Navigation Bar에서 "Data" 클릭
- URL: `/data`

#### 처리
1. **페이지 렌더링**
   - 데이터 테이블 표시
   - 필터 및 검색 UI 표시

2. **초기 데이터 로드**
   - `dataApi.getData(filters, pagination)` 호출
   - 기본 필터:
     - 페이지: 1
     - 페이지 크기: 20
     - 정렬: 날짜 내림차순

#### 출력
- **데이터 조회 페이지 레이아웃**

```
┌─────────────────────────────────────────────────────────┐
│  데이터 조회                                            │
├─────────────────────────────────────────────────────────┤
│  필터                                                   │
│  데이터 유형: [전체 ▼]  기간: [2024년 ▼]  검색: [   ] │
│  [적용] [초기화]                                        │
├─────────────────────────────────────────────────────────┤
│  데이터 테이블                         [CSV 다운로드]   │
│  ┌───────────────────────────────────────────────────┐  │
│  │ 날짜       유형   항목         금액     상세     │  │
│  │ 2024-11-01 실적  연구과제A   1,200,000  [보기] │  │
│  │ 2024-10-28 논문  국제학술지     -       [보기] │  │
│  │ 2024-10-25 예산  인건비      5,000,000  [보기] │  │
│  │ ...                                             │  │
│  └───────────────────────────────────────────────────┘  │
│  << < 1 2 3 4 5 > >>                     총 245건      │
└─────────────────────────────────────────────────────────┘
```

#### 예외 처리
- **데이터 없음**
  - 빈 상태 UI: "조회 가능한 데이터가 없습니다."
  - 관리자: [Excel 업로드] 버튼

---

### 3.4.2 데이터 필터링 및 검색

#### 입력
- 데이터 유형 선택 (전체, 실적, 논문, 학생, 예산)
- 기간 선택 (연도, 분기, 월)
- 검색어 입력 (항목명, 설명 등)
- [적용] 버튼

#### 처리
1. **필터 적용**
   - 쿼리 파라미터 생성
   - `dataApi.getData({ type, year, quarter, search })` 호출

2. **백엔드 필터링**
   - ORM 쿼리 필터링
   - 페이지네이션 적용

#### 출력
- 필터링된 데이터 테이블
- 총 결과 수 업데이트

#### 예외 처리
- **검색 결과 없음**
  - 메시지: "검색 결과가 없습니다."
  - [필터 초기화] 버튼

---

### 3.4.3 데이터 상세 조회

#### 입력
- 테이블 행의 [보기] 버튼 클릭

#### 처리
1. **상세 모달 표시**
   - 선택한 행의 모든 필드 표시
   - 관련 정보 표시 (업로드 일시, 업로드 사용자 등)

#### 출력
- 모달 팝업:
  ```
  ┌─────────────────────────────────────┐
  │  데이터 상세                    [X] │
  ├─────────────────────────────────────┤
  │  날짜: 2024-11-01                   │
  │  유형: 실적                         │
  │  항목: 연구과제 A                   │
  │  금액: 1,200,000원                  │
  │  카테고리: 연구비                   │
  │  설명: 정부지원 연구과제            │
  │  업로드: 2024-11-01 10:30 (홍길동) │
  ├─────────────────────────────────────┤
  │  [닫기] [수정] [삭제]               │
  └─────────────────────────────────────┘
  ```

- 관리자만 [수정] [삭제] 버튼 표시

---

### 3.4.4 데이터 내보내기 (CSV)

#### 입력
- [CSV 다운로드] 버튼 클릭

#### 처리
1. **다운로드 확인**
   - 현재 필터 조건으로 다운로드할지 확인
   - 메시지: "현재 필터 조건(실적, 2024년)으로 245건을 다운로드하시겠습니까?"

2. **CSV 생성 (Backend)**
   - `DataExportService.export_to_csv(filters)`
   - CSV 파일 생성 (UTF-8 with BOM)
   - 헤더: 컬럼명
   - 본문: 필터링된 데이터

3. **파일 다운로드 (Frontend)**
   - Blob 생성
   - 파일명: `data_export_20241101.csv`
   - 브라우저 다운로드 트리거

#### 출력
- CSV 파일 다운로드
- 성공 메시지: "245건의 데이터가 다운로드되었습니다."

#### 예외 처리
- **대용량 데이터**
  - 10,000건 초과 시 경고: "데이터가 매우 많습니다. 다운로드에 시간이 걸릴 수 있습니다."
  - 비동기 처리 및 이메일 발송 옵션 제공

---

## 3.5 프로필 관리 플로우

### 3.5.1 프로필 조회

#### 입력
- Navigation Bar에서 "Profile" 클릭 또는 프로필 아이콘 클릭
- URL: `/profile`

#### 처리
1. **프로필 데이터 로드**
   - `accountApi.getProfile()` 호출
   - Backend: `UserRepository.get_by_id(user_id)`

#### 출력
- **프로필 페이지 레이아웃**

```
┌─────────────────────────────────────────────┐
│  프로필                                     │
├─────────────────────────────────────────────┤
│  ┌────────┐                                 │
│  │  사진  │  홍길동                         │
│  │        │  hong@university.ac.kr          │
│  └────────┘  컴퓨터공학과 / 관리자          │
├─────────────────────────────────────────────┤
│  기본 정보                                  │
│  이름: 홍길동                               │
│  이메일: hong@university.ac.kr              │
│  부서: 컴퓨터공학과                         │
│  역할: 관리자                               │
│  가입일: 2024-01-15                         │
├─────────────────────────────────────────────┤
│  [프로필 수정] [비밀번호 변경]              │
└─────────────────────────────────────────────┘
```

---

### 3.5.2 프로필 수정

#### 입력
- [프로필 수정] 버튼 클릭
- 수정 가능 필드:
  - 이름
  - 프로필 사진
  - 부서
- [저장] 버튼

#### 처리
1. **수정 모드 전환**
   - 입력 필드 활성화
   - [취소] [저장] 버튼 표시

2. **입력 검증**
   - 이름: 2-50자
   - 사진: 최대 2MB, JPG/PNG만

3. **업데이트 요청**
   - `accountApi.updateProfile(profileData)` 호출
   - Backend: `ProfileService.update_profile(user_id, data)`

#### 출력
- 성공: "프로필이 업데이트되었습니다."
- 프로필 조회 모드로 전환

#### 예외 처리
- **사진 크기 초과**
  - 메시지: "프로필 사진은 2MB 이하여야 합니다."

---

### 3.5.3 비밀번호 변경

#### 입력
- [비밀번호 변경] 버튼 클릭
- 모달 표시:
  - 현재 비밀번호
  - 새 비밀번호
  - 새 비밀번호 확인
- [변경] 버튼

#### 처리
1. **입력 검증**
   - 현재 비밀번호: 공백 불가
   - 새 비밀번호: 8자 이상, 영문+숫자+특수문자 조합
   - 비밀번호 확인: 새 비밀번호와 일치

2. **비밀번호 변경 요청**
   - Supabase Auth API 호출
   - 현재 비밀번호 검증
   - 새 비밀번호로 업데이트

#### 출력
- 성공: "비밀번호가 변경되었습니다. 다시 로그인해주세요."
- 로그아웃 처리 → 로그인 페이지

#### 예외 처리
- **현재 비밀번호 불일치**
  - 메시지: "현재 비밀번호가 올바르지 않습니다."

- **약한 비밀번호**
  - 메시지: "비밀번호는 8자 이상, 영문, 숫자, 특수문자를 포함해야 합니다."

---

## 화면 전환 다이어그램

### 전체 화면 전환 흐름

```
                    [시작]
                      ↓
              [로그인 페이지]
                /         \
        인증 실패          인증 성공
            ↓                  ↓
      [오류 메시지]      [대시보드 페이지] ←──────┐
                              ↓                    │
            ┌─────────────────┼─────────────────┐  │
            ↓                 ↓                 ↓  │
      [업로드 페이지]   [데이터 조회]    [프로필 페이지]
       (관리자만)                                  │
            ↓                                     │
      [업로드 성공] ────────────────────────────────┘
```

### 상세 화면 전환 매트릭스

| 현재 페이지 | 이동 가능한 페이지 | 트리거 |
|------------|------------------|--------|
| 로그인 | 대시보드 | 로그인 성공 |
| 대시보드 | 업로드 (관리자), 데이터 조회, 프로필 | Navigation 클릭 |
| 업로드 | 대시보드, 데이터 조회 | 업로드 성공 후 버튼 |
| 데이터 조회 | 대시보드, 업로드 (관리자), 프로필 | Navigation 클릭 |
| 프로필 | 대시보드, 업로드 (관리자), 데이터 조회 | Navigation 클릭 |
| 모든 페이지 | 로그인 | 로그아웃 또는 세션 만료 |

---

## 예외 상황 처리

### 5.1 네트워크 오류

#### 시나리오
- API 요청 중 네트워크 연결 끊김
- 서버 응답 없음 (타임아웃)

#### 처리
1. **자동 재시도**
   - Axios Interceptor에서 재시도 로직
   - 최대 3회 재시도 (지수 백오프: 1초, 2초, 4초)

2. **사용자 알림**
   - 재시도 실패 시 오류 메시지 표시
   - "네트워크 오류가 발생했습니다. 인터넷 연결을 확인해주세요."

3. **오프라인 모드 (Optional)**
   - Service Worker로 캐시된 데이터 표시
   - 배너: "오프라인 상태입니다. 일부 기능이 제한됩니다."

---

### 5.2 서버 오류 (500)

#### 시나리오
- 백엔드 내부 오류
- 데이터베이스 연결 실패

#### 처리
1. **오류 로깅**
   - Frontend: Sentry 등으로 오류 전송
   - Backend: 로그 파일 기록

2. **사용자 알림**
   - "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요."
   - [다시 시도] 버튼

3. **대체 UI**
   - 오류 페이지 표시
   - 관리자 연락처 안내

---

### 5.3 인증 만료

#### 시나리오
- Access Token 만료
- Refresh Token 만료

#### 처리
1. **Access Token 만료**
   - Axios Interceptor에서 401 감지
   - Refresh Token으로 자동 갱신 시도
   - 갱신 성공 시 원래 요청 재시도

2. **Refresh Token 만료**
   - 로그인 페이지로 리다이렉트
   - 메시지: "세션이 만료되었습니다. 다시 로그인해주세요."
   - 원래 접근하려던 URL 저장 (로그인 후 복원)

---

### 5.4 권한 부족 (403)

#### 시나리오
- 일반 사용자가 관리자 전용 페이지 접근
- 삭제 권한 없는 사용자가 삭제 시도

#### 처리
1. **Frontend Guard**
   - Route Guard에서 권한 확인
   - 권한 없으면 접근 차단 (페이지 렌더링 전)

2. **Backend 검증**
   - Middleware에서 권한 재확인
   - 403 Forbidden 응답

3. **사용자 알림**
   - 403 페이지 표시
   - "접근 권한이 없습니다."
   - [대시보드로 돌아가기] 버튼

---

### 5.5 데이터베이스 제약 조건 위반

#### 시나리오
- 중복 데이터 삽입 시도
- 외래 키 제약 조건 위반

#### 처리
1. **ORM 예외 처리**
   - Django `IntegrityError` 캐치
   - 사용자 친화적 메시지로 변환

2. **사용자 알림**
   - 중복: "이미 존재하는 데이터입니다."
   - 외래 키: "참조된 데이터를 먼저 삭제해주세요."

---

## 엣지케이스 시나리오

### 6.1 동시성 문제

#### 시나리오
- 두 명의 관리자가 동시에 같은 데이터를 수정
- Excel 업로드 중 다른 관리자가 동일 데이터 삭제

#### 처리
1. **낙관적 잠금 (Optimistic Locking)**
   - 데이터에 `version` 필드 추가
   - 업데이트 시 version 체크
   - version 불일치 시 충돌 감지

2. **사용자 알림**
   - "다른 사용자가 이 데이터를 수정했습니다. 페이지를 새로고침해주세요."

3. **충돌 해결 UI**
   - 변경 사항 비교 모달 표시
   - 사용자가 선택: [내 변경사항 유지] [다른 사용자 변경사항 수용]

---

### 6.2 대용량 데이터 처리

#### 시나리오
- 100만 행의 Excel 파일 업로드
- 대시보드에서 10만 건의 데이터 조회

#### 처리

##### Excel 업로드
1. **청크 단위 처리**
   - 파일을 1,000행씩 나눠서 처리
   - 프로그레스 바 업데이트 (10%, 20%, ...)

2. **비동기 처리**
   - Celery 등으로 백그라운드 작업 처리
   - 작업 상태 추적 (대기 중, 처리 중, 완료)
   - 완료 후 이메일 알림

##### 데이터 조회
1. **페이지네이션**
   - 한 페이지에 최대 100건만 표시
   - 커서 기반 페이지네이션 (성능 최적화)

2. **가상 스크롤**
   - 화면에 보이는 행만 렌더링
   - 스크롤 시 동적 로드

3. **필터 권장**
   - "데이터가 많습니다. 필터를 사용하시면 더 빠릅니다."

---

### 6.3 브라우저 호환성

#### 시나리오
- 구형 브라우저 (IE11) 접속
- JavaScript 비활성화

#### 처리
1. **브라우저 감지**
   - User-Agent 체크
   - 지원하지 않는 브라우저 감지

2. **사용자 알림**
   - 경고 배너: "이 브라우저는 지원하지 않습니다. Chrome, Firefox, Edge를 사용해주세요."
   - 다운로드 링크 제공

3. **JavaScript 비활성화**
   - `<noscript>` 태그로 메시지 표시
   - "이 웹사이트는 JavaScript가 필요합니다."

---

### 6.4 파일 업로드 중단

#### 시나리오
- 업로드 중 브라우저 닫기
- 업로드 중 네트워크 끊김

#### 처리
1. **업로드 재개 (Resumable Upload)**
   - 청크 단위 업로드
   - 중단된 지점부터 재개

2. **임시 파일 정리**
   - 불완전한 업로드 파일 자동 삭제 (24시간 후)

3. **사용자 알림**
   - "업로드가 중단되었습니다. 다시 시도하시겠습니까?"

---

### 6.5 세션 하이재킹 방어

#### 시나리오
- 토큰 탈취 시도
- CSRF 공격

#### 처리
1. **JWT 보안**
   - 짧은 만료 시간 (15분)
   - Refresh Token은 httpOnly 쿠키에 저장
   - IP 주소 변경 감지

2. **CSRF 토큰**
   - Django CSRF 미들웨어 활성화
   - 모든 POST 요청에 CSRF 토큰 포함

3. **의심스러운 활동 감지**
   - 로그인 위치 변경 감지
   - 사용자에게 알림: "새로운 위치에서 로그인이 감지되었습니다."

---

### 6.6 데이터 무결성 보장

#### 시나리오
- Excel 업로드 중 서버 다운
- 트랜잭션 중간에 오류 발생

#### 처리
1. **트랜잭션 보장**
   - Django `@transaction.atomic` 데코레이터 사용
   - 전체 성공 또는 전체 롤백

2. **롤백 로깅**
   - 롤백 발생 시 로그 기록
   - 관리자에게 알림

3. **사용자 알림**
   - "업로드 중 오류가 발생했습니다. 데이터가 저장되지 않았습니다."

---

### 6.7 다국어 지원 (Future)

#### 시나리오
- 영어 사용자 접속
- 외국인 교수 로그인

#### 처리
1. **다국어 설정**
   - Frontend: i18n 라이브러리 (react-i18next)
   - Backend: Django i18n

2. **언어 선택 UI**
   - Navigation Bar에 언어 선택 드롭다운
   - 사용자 선호 언어 저장

3. **번역 파일**
   - JSON 형식으로 번역 관리
   - 예: `ko.json`, `en.json`

---

### 6.8 접근성 (Accessibility)

#### 시나리오
- 시각 장애인 스크린 리더 사용
- 키보드만으로 조작

#### 처리
1. **ARIA 속성**
   - 모든 인터랙티브 요소에 `aria-label` 추가
   - 폼 필드에 `aria-required`, `aria-invalid` 추가

2. **키보드 네비게이션**
   - Tab 키로 모든 요소 접근 가능
   - Enter/Space로 버튼 클릭

3. **색상 대비**
   - WCAG AA 기준 준수
   - 고대비 모드 지원

---

### 6.9 데이터 백업 및 복구

#### 시나리오
- 실수로 데이터 삭제
- 데이터베이스 장애

#### 처리
1. **소프트 삭제**
   - 데이터를 실제로 삭제하지 않고 `is_deleted` 플래그 설정
   - 30일 후 자동 영구 삭제

2. **복구 기능**
   - 관리자 전용 "삭제된 항목" 페이지
   - [복구] 버튼으로 데이터 복원

3. **자동 백업**
   - 매일 자동 데이터베이스 백업
   - S3 등에 백업 파일 저장

---

### 6.10 성능 저하 시 대응

#### 시나리오
- 동시 접속자 급증
- 데이터베이스 쿼리 지연

#### 처리
1. **캐싱**
   - Redis로 대시보드 데이터 캐싱 (5분 TTL)
   - 정적 자산 CDN 캐싱

2. **쿼리 최적화**
   - N+1 쿼리 방지 (`select_related`, `prefetch_related`)
   - 데이터베이스 인덱스 추가

3. **로딩 상태 개선**
   - Skeleton UI 표시 (빈 화면 대신)
   - 점진적 로딩 (중요한 데이터 먼저)

---

## 부록: 주요 API 엔드포인트

### 인증
- `POST /api/auth/login/` - 로그인
- `POST /api/auth/logout/` - 로그아웃
- `POST /api/auth/refresh/` - 토큰 갱신

### 대시보드
- `GET /api/dashboard/` - 대시보드 데이터 조회
- `GET /api/dashboard/metrics/` - 주요 지표만 조회
- `GET /api/dashboard/charts/{chart_type}/` - 특정 차트 데이터

### 업로드
- `POST /api/upload/excel/` - Excel 파일 업로드
- `GET /api/upload/history/` - 업로드 이력 조회
- `DELETE /api/upload/{id}/` - 업로드 기록 삭제
- `POST /api/upload/{id}/retry/` - 업로드 재시도

### 데이터 조회
- `GET /api/data/` - 데이터 목록 조회 (필터링, 페이지네이션)
- `GET /api/data/{id}/` - 데이터 상세 조회
- `PUT /api/data/{id}/` - 데이터 수정 (관리자)
- `DELETE /api/data/{id}/` - 데이터 삭제 (관리자)
- `GET /api/data/export/csv/` - CSV 내보내기

### 프로필
- `GET /api/account/profile/` - 프로필 조회
- `PUT /api/account/profile/` - 프로필 수정
- `POST /api/account/change-password/` - 비밀번호 변경

---

## 요약

본 문서는 대학교 사내 데이터 시각화 대시보드 프로젝트의 모든 사용자 플로우를 정의합니다.

### 주요 플로우
1. **인증**: 로그인, 로그아웃, 권한 검증
2. **대시보드**: 데이터 조회, 필터링, 차트 상호작용
3. **업로드**: Excel 파일 업로드, 파싱, 검증, 저장
4. **데이터 조회**: 필터링, 검색, 상세 조회, CSV 내보내기
5. **프로필**: 조회, 수정, 비밀번호 변경

### 예외 처리
- 네트워크 오류, 서버 오류, 인증 만료, 권한 부족, 데이터베이스 제약 조건 위반

### 엣지케이스
- 동시성 문제, 대용량 데이터, 브라우저 호환성, 파일 업로드 중단, 보안, 데이터 무결성, 성능 저하

이 문서를 기반으로 개발 시 모든 사용자 시나리오를 고려하여 안정적이고 사용자 친화적인 시스템을 구축할 수 있습니다.
